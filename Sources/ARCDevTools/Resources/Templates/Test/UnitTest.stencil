import XCTest
@testable import {{ module }}

final class {{ feature }}Tests: XCTestCase {

    // MARK: - Properties

    var sut: {{ feature }}ViewModel!
    var mockService: {{ feature }}ServiceMock!

    // MARK: - Setup & Teardown

    override func setUp() {
        super.setUp()
        mockService = {{ feature }}ServiceMock()
        sut = {{ feature }}ViewModel(service: mockService)
    }

    override func tearDown() {
        sut = nil
        mockService = nil
        super.tearDown()
    }

    // MARK: - Tests

    func testInitialState() {
        XCTAssertEqual(sut.state, .idle)
    }

    func testLoadSuccess() async {
        // Given
        mockService.shouldFail = false

        // When
        await sut.load()

        // Then
        XCTAssertEqual(sut.state, .loaded)
        XCTAssertEqual(mockService.loadCallCount, 1)
    }

    func testLoadFailure() async {
        // Given
        mockService.shouldFail = true

        // When
        await sut.load()

        // Then
        if case .error = sut.state {
            XCTAssertTrue(true)
        } else {
            XCTFail("Expected error state")
        }
    }
}
